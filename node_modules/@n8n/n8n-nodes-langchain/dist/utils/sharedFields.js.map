{"version":3,"sources":["../../utils/sharedFields.ts"],"sourcesContent":["import { NodeConnectionTypes } from 'n8n-workflow';\nimport type { IDisplayOptions, INodeProperties } from 'n8n-workflow';\n\nexport const metadataFilterField: INodeProperties = {\n\tdisplayName: 'Metadata Filter',\n\tname: 'metadata',\n\ttype: 'fixedCollection',\n\tdescription: 'Metadata to filter the document by',\n\ttypeOptions: {\n\t\tmultipleValues: true,\n\t},\n\tdefault: {},\n\tplaceholder: 'Add filter field',\n\toptions: [\n\t\t{\n\t\t\tname: 'metadataValues',\n\t\t\tdisplayName: 'Fields to Set',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tdisplayName: 'Name',\n\t\t\t\t\tname: 'name',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdefault: '',\n\t\t\t\t\trequired: true,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tdisplayName: 'Value',\n\t\t\t\t\tname: 'value',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdefault: '',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t],\n};\n\nexport function getTemplateNoticeField(templateId: number): INodeProperties {\n\treturn {\n\t\tdisplayName: `Save time with an <a href=\"/templates/${templateId}\" target=\"_blank\">example</a> of how this node works`,\n\t\tname: 'notice',\n\t\ttype: 'notice',\n\t\tdefault: '',\n\t};\n}\n\nexport function getBatchingOptionFields(\n\tdisplayOptions: IDisplayOptions | undefined,\n\tdefaultBatchSize: number = 5,\n): INodeProperties {\n\treturn {\n\t\tdisplayName: 'Batch Processing',\n\t\tname: 'batching',\n\t\ttype: 'collection',\n\t\tplaceholder: 'Add Batch Processing Option',\n\t\tdescription: 'Batch processing options for rate limiting',\n\t\tdefault: {},\n\t\toptions: [\n\t\t\t{\n\t\t\t\tdisplayName: 'Batch Size',\n\t\t\t\tname: 'batchSize',\n\t\t\t\tdefault: defaultBatchSize,\n\t\t\t\ttype: 'number',\n\t\t\t\tdescription:\n\t\t\t\t\t'How many items to process in parallel. This is useful for rate limiting, but might impact the log output ordering.',\n\t\t\t},\n\t\t\t{\n\t\t\t\tdisplayName: 'Delay Between Batches',\n\t\t\t\tname: 'delayBetweenBatches',\n\t\t\t\tdefault: 0,\n\t\t\t\ttype: 'number',\n\t\t\t\tdescription: 'Delay in milliseconds between batches. This is useful for rate limiting.',\n\t\t\t},\n\t\t],\n\t\tdisplayOptions,\n\t};\n}\n\nconst connectionsString = {\n\t[NodeConnectionTypes.AiAgent]: {\n\t\t// Root AI view\n\t\tconnection: '',\n\t\tlocale: 'AI Agent',\n\t},\n\t[NodeConnectionTypes.AiChain]: {\n\t\t// Root AI view\n\t\tconnection: '',\n\t\tlocale: 'AI Chain',\n\t},\n\t[NodeConnectionTypes.AiDocument]: {\n\t\tconnection: NodeConnectionTypes.AiDocument,\n\t\tlocale: 'Document Loader',\n\t},\n\t[NodeConnectionTypes.AiVectorStore]: {\n\t\tconnection: NodeConnectionTypes.AiVectorStore,\n\t\tlocale: 'Vector Store',\n\t},\n\t[NodeConnectionTypes.AiRetriever]: {\n\t\tconnection: NodeConnectionTypes.AiRetriever,\n\t\tlocale: 'Vector Store Retriever',\n\t},\n};\n\ntype AllowedConnectionTypes =\n\t| typeof NodeConnectionTypes.AiAgent\n\t| typeof NodeConnectionTypes.AiChain\n\t| typeof NodeConnectionTypes.AiDocument\n\t| typeof NodeConnectionTypes.AiVectorStore\n\t| typeof NodeConnectionTypes.AiRetriever;\n\nfunction determineArticle(nextWord: string): string {\n\t// check if the next word starts with a vowel sound\n\tconst vowels = /^[aeiouAEIOU]/;\n\treturn vowels.test(nextWord) ? 'an' : 'a';\n}\nconst getConnectionParameterString = (connectionType: string) => {\n\tif (connectionType === '') return \"data-action-parameter-creatorview='AI'\";\n\n\treturn `data-action-parameter-connectiontype='${connectionType}'`;\n};\nconst getAhref = (connectionType: { connection: string; locale: string }) =>\n\t`<a class=\"test\" data-action='openSelectiveNodeCreator'${getConnectionParameterString(\n\t\tconnectionType.connection,\n\t)}'>${connectionType.locale}</a>`;\n\nexport function getConnectionHintNoticeField(\n\tconnectionTypes: AllowedConnectionTypes[],\n): INodeProperties {\n\tconst groupedConnections = new Map<string, string[]>();\n\n\t// group connection types by their 'connection' value\n\t// to not create multiple links\n\tconnectionTypes.forEach((connectionType) => {\n\t\tconst connectionString = connectionsString[connectionType].connection;\n\t\tconst localeString = connectionsString[connectionType].locale;\n\n\t\tif (!groupedConnections.has(connectionString)) {\n\t\t\tgroupedConnections.set(connectionString, [localeString]);\n\t\t\treturn;\n\t\t}\n\n\t\tgroupedConnections.get(connectionString)?.push(localeString);\n\t});\n\n\tlet displayName;\n\n\tif (groupedConnections.size === 1) {\n\t\tconst [[connection, locales]] = Array.from(groupedConnections);\n\n\t\tdisplayName = `This node must be connected to ${determineArticle(locales[0])} ${locales[0]\n\t\t\t.toLowerCase()\n\t\t\t.replace(\n\t\t\t\t/^ai /,\n\t\t\t\t'AI ',\n\t\t\t)}. <a data-action='openSelectiveNodeCreator' ${getConnectionParameterString(\n\t\t\tconnection,\n\t\t)}>Insert one</a>`;\n\t} else {\n\t\tconst ahrefs = Array.from(groupedConnections, ([connection, locales]) => {\n\t\t\t// If there are multiple locales, join them with ' or '\n\t\t\t// use determineArticle to insert the correct article\n\t\t\tconst locale =\n\t\t\t\tlocales.length > 1\n\t\t\t\t\t? locales\n\t\t\t\t\t\t\t.map((localeString, index, { length }) => {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t(index === 0 ? `${determineArticle(localeString)} ` : '') +\n\t\t\t\t\t\t\t\t\t(index < length - 1 ? `${localeString} or ` : localeString)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.join('')\n\t\t\t\t\t: `${determineArticle(locales[0])} ${locales[0]}`;\n\t\t\treturn getAhref({ connection, locale });\n\t\t});\n\n\t\tdisplayName = `This node needs to be connected to ${ahrefs.join(' or ')}.`;\n\t}\n\n\treturn {\n\t\tdisplayName,\n\t\tname: 'notice',\n\t\ttype: 'notice',\n\t\tdefault: '',\n\t\ttypeOptions: {\n\t\t\tcontainerClass: 'ndv-connection-hint-notice',\n\t\t},\n\t};\n}\n"],"mappings":"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","names":[]}