{"version":3,"sources":["../../../../nodes/chains/InformationExtractor/processItem.ts"],"sourcesContent":["import type { BaseLanguageModel } from '@langchain/core/language_models/base';\nimport { HumanMessage } from '@langchain/core/messages';\nimport { ChatPromptTemplate, SystemMessagePromptTemplate } from '@langchain/core/prompts';\nimport type { OutputFixingParser } from 'langchain/output_parsers';\nimport { NodeOperationError, type IExecuteFunctions } from 'n8n-workflow';\n\nimport { getTracingConfig } from '@utils/tracing';\n\nimport { SYSTEM_PROMPT_TEMPLATE } from './constants';\n\nexport async function processItem(\n\tctx: IExecuteFunctions,\n\titemIndex: number,\n\tllm: BaseLanguageModel,\n\tparser: OutputFixingParser<object>,\n) {\n\tconst input = ctx.getNodeParameter('text', itemIndex) as string;\n\tif (!input?.trim()) {\n\t\tthrow new NodeOperationError(ctx.getNode(), `Text for item ${itemIndex} is not defined`, {\n\t\t\titemIndex,\n\t\t});\n\t}\n\tconst inputPrompt = new HumanMessage(input);\n\n\tconst options = ctx.getNodeParameter('options', itemIndex, {}) as {\n\t\tsystemPromptTemplate?: string;\n\t};\n\n\tconst systemPromptTemplate = SystemMessagePromptTemplate.fromTemplate(\n\t\t`${options.systemPromptTemplate ?? SYSTEM_PROMPT_TEMPLATE}\n{format_instructions}`,\n\t);\n\n\tconst messages = [\n\t\tawait systemPromptTemplate.format({\n\t\t\tformat_instructions: parser.getFormatInstructions(),\n\t\t}),\n\t\tinputPrompt,\n\t];\n\tconst prompt = ChatPromptTemplate.fromMessages(messages);\n\tconst chain = prompt.pipe(llm).pipe(parser).withConfig(getTracingConfig(ctx));\n\n\treturn await chain.invoke(messages);\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,sBAA6B;AAC7B,qBAAgE;AAEhE,0BAA2D;AAE3D,qBAAiC;AAEjC,uBAAuC;AAEvC,eAAsB,YACrB,KACA,WACA,KACA,QACC;AACD,QAAM,QAAQ,IAAI,iBAAiB,QAAQ,SAAS;AACpD,MAAI,CAAC,OAAO,KAAK,GAAG;AACnB,UAAM,IAAI,uCAAmB,IAAI,QAAQ,GAAG,iBAAiB,SAAS,mBAAmB;AAAA,MACxF;AAAA,IACD,CAAC;AAAA,EACF;AACA,QAAM,cAAc,IAAI,6BAAa,KAAK;AAE1C,QAAM,UAAU,IAAI,iBAAiB,WAAW,WAAW,CAAC,CAAC;AAI7D,QAAM,uBAAuB,2CAA4B;AAAA,IACxD,GAAG,QAAQ,wBAAwB,uCAAsB;AAAA;AAAA,EAE1D;AAEA,QAAM,WAAW;AAAA,IAChB,MAAM,qBAAqB,OAAO;AAAA,MACjC,qBAAqB,OAAO,sBAAsB;AAAA,IACnD,CAAC;AAAA,IACD;AAAA,EACD;AACA,QAAM,SAAS,kCAAmB,aAAa,QAAQ;AACvD,QAAM,QAAQ,OAAO,KAAK,GAAG,EAAE,KAAK,MAAM,EAAE,eAAW,iCAAiB,GAAG,CAAC;AAE5E,SAAO,MAAM,MAAM,OAAO,QAAQ;AACnC;","names":[]}